#VRML V2.0 utf8

NavigationInfo { type [ "WALK"] }


DEF deloin Viewpoint {
 position 16 1 -9
orientation 0 1 0 3.14
fieldOfView 1.3
 description "pres du labyrinthe"
}

DEF EntryView Viewpoint {
position 16.5 1 1.5
orientation 0 1 0 3.14
fieldOfView 1.5
 description  "entree"
}

#DEF bleu Viewpoint {
 #position 0 1 15
 #description "sortie"
#}

#DEF triche Viewpoint {
#position 5 1 33
#orientation 0 1 0 -1.57
 #description  "triche"
#}


#DEF dessus Viewpoint {
 #position 17 50 5
 #orientation    1 0  0  -1.57
 #description "vue de dessus"}

DEF Labyrinthe Transform {
translation 0 0 0
children [
 Inline {
  url "labyrinthe.wrl"  }
  ]
 }

Background {


skyAngle     [ 0.7, 1.2, 1.6, 2.2 ]

skyColor     [ 0 0 0.9, 0 0.2 0.7, 0 0.3 0.6, 0 0.4 0.3]
 }


DEF Tableau Transform {
translation 13.5 1 0
children [
 
   Shape {

            appearance Appearance { 
                material Material { 
                diffuseColor 0 0 0 } 
            } 
            geometry Box { 
               size 2 2 0.01 }
   }
  ]
}



Transform {
 translation 14.5 1.5 -0.1
 rotation 0 1 0 3.14
  children [
    Shape {
    
geometry DEF blabout2 Text {
      string ["Voici un labyrinthe!"]
   fontStyle FontStyle {
      size 0.2 }
    }
   }
  ]
}  


Transform {
 translation 13.25 1 -0.1
 rotation 0 1 0 3.14
 children [
 Shape {

                    appearance Appearance { 
                material Material { 
                diffuseColor 0.4 0.5 0.5} 
            } 

geometry DEF blabla Text {
      string [""]
  
   fontStyle FontStyle {
      size 0.2
      
    }
}
    }
  ]
}
Transform {
 translation 14.5 0.5 -0.1
 rotation 0 1 0 3.14
  children [
    Shape {
    
geometry DEF blabout2 Text {
      string [""]
   fontStyle FontStyle {
      size 0.2 }
    }
   }
  ]
}  

DEF Tempsmaintenant TimeSensor {
   enabled TRUE
 }


  



#proximity sensor du début
DEF ProxyEntree ProximitySensor {
 		center  16.5 0 2
		size 1.5 10 1
                    enabled TRUE
  }

#proximity sensor de la sortie
DEF ProxySortie ProximitySensor {
 		center  3 0 25.5
		size 2 10 1.5
        enabled TRUE                        
  }

#proximity sensor pour revenir au début de la scène
DEF ProxyDehors ProximitySensor {
 		center  0 0 25.5
		size 2 10 1.5
        enabled TRUE                        
  }

DEF MyBeautifulScript Script {
 eventIn SFTime inside
 eventIn SFTime outside
 eventIn SFBool teleportback
 field SFTime StartTime 0
 field SFBool AlreadyIn FALSE
 field MFTime TempsSortieUn 0
 field SFBool Essai2 FALSE
 eventOut SFBool pointdevue
 eventOut MFString TimeThrough
 eventOut MFString Analyse
 eventOut SFBool retourahowardsend
 url "vrmlscript:
    function inside(timestamp)
    {
       if (Essai2 == FALSE)
      {
        if (AlreadyIn == FALSE)
         {
           StartTime = timestamp;
           pointdevue = TRUE;
           AlreadyIn = TRUE;
          }
      }
     else {
          if (AlreadyIn == FALSE)
         {
           StartTime = timestamp;
           pointdevue = TRUE;
           AlreadyIn = TRUE;
          }
          
        }


     }
    function outside(timestamp)
    { 
      if (Essai2 == FALSE)
     {  
        TempsSortieUn = new MFTime(timestamp-StartTime);
        TimeThrough = new MFString ;
          TimeThrough[0] = '1er temps' ;
          TimeThrough[1] = (TempsSortieUn.toString());
          TimeThrough[2] = 'ressaie';
      AlreadyIn = FALSE;
       Essai2 = TRUE;
        }
       else
       {

        var TempsDelta = new MFTime(TempsSortieUn[0] - (timestamp-StartTime));

          TimeThrough = new MFString;
          TimeThrough[0] = 'difference de temps' ;
          TimeThrough[1] = (TempsDelta.toString());
      

        	if (TempsDelta[0] >0)
               { Analyse[0] = 'Bravo, tu as fait mieux';
                                 }
            else 
		   { Analyse[0] = 'Helas, tu as fait plus long';
               }



	  AlreadyIn = FALSE;
        Essai2 = FALSE;
       }
     }
     
   
    function teleportback(active)
    {
      retourahowardsend = TRUE;
    }"
    }




ROUTE ProxyEntree.enterTime TO MyBeautifulScript.inside
ROUTE MyBeautifulScript.pointdevue TO EntryView.set_bind

ROUTE ProxySortie.enterTime TO MyBeautifulScript.outside
ROUTE MyBeautifulScript.TimeThrough TO blabla.string
ROUTE MyBeautifulScript.Analyse TO blabout2.string

ROUTE ProxyDehors.isActive TO MyBeautifulScript.teleportback
ROUTE MyBeautifulScript.retourahowardsend TO deloin.set_bind
